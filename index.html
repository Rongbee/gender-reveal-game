	<!DOCTYPE html>
	<html lang="zh-TW">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>æ©æ©å¯¶å¯¶çš„å¥‡å¹»ä¸–ç•Œ - æ€§åˆ¥æ´¾å°</title>
		<style>
			/* --- åŸºç¤å…±ç”¨è¨­å®š --- */
			body { 
				margin: 0; display: flex; justify-content: center; align-items: center; 
				min-height: 100vh; font-family: 'Microsoft JhengHei', sans-serif;
				transition: background 0.8s ease;
			}
			#game-container { transition: all 0.8s ease; position: relative; overflow: hidden; }
			
			/* --- æ¨¡å¼ä¸€ï¼šåˆ†æ”¯åŠ‡æƒ… (Adventure) --- */
			body.mode-adventure { background: linear-gradient(135deg, #fdeff9, #ecf9ff); color: #333; }
			.mode-adventure #game-container { 
				background: #fff; max-width: 420px; width: 90%; padding: 30px; 
				border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
			}
			.mode-adventure #portrait { display: none; }
			.mode-adventure #character-name { color: #ff6b6b; font-size: 1.4em; margin-bottom: 15px; }
			.mode-adventure #dialogue-text { font-size: 1.1rem; line-height: 1.6; white-space: pre-wrap; }

			/* --- æ¨¡å¼äºŒï¼šå¤©åº­å°è©± (Heaven) --- */
			body.mode-heaven { background: #2c3e50; color: white; }
			.mode-heaven #game-container { 
				width: 95%; max-width: 800px; height: 550px; background: #34495e; 
				border: 4px solid #ecf0f1; border-radius: 15px; padding: 25px; box-sizing: border-box;
				display: flex; flex-direction: column; justify-content: flex-end;
			}
			.mode-heaven #story-section { flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-end; }
			.mode-heaven #portrait { 
				width: 120px; height: 120px; background: #95a5a6; border-radius: 10px; 
				margin-bottom: 10px; border: 3px solid gold; display: flex; 
				align-items: center; justify-content: center; font-size: 60px; 
			}
			.mode-heaven #dialogue-box { 
				background: rgba(0,0,0,0.85); border: 2px solid #bdc3c7; 
				padding: 20px; border-radius: 10px; cursor: pointer; min-height: 120px;
			}
			.mode-heaven #character-name { font-size: 1.3em; margin-bottom: 8px; }
			.mode-heaven #dialogue-text { font-size: 1.2rem; line-height: 1.5; }

			/* --- æŒ‰éˆ•æ¨£å¼ --- */
			.choices-area { margin-top: 20px; width: 100%; }
			.choice-btn {
				display: block; width: 100%; padding: 12px; margin: 10px 0;
				font-size: 1rem; border-radius: 10px; border: none; cursor: pointer;
				background: #f0f4ff; transition: all 0.2s;
			}
			.choice-btn:hover { background: #e0e8ff; transform: translateY(-2px); }
			.mode-heaven .choice-btn { background: #e67e22; color: white; border: 1px solid #d35400; }
			.mode-heaven .choice-btn:hover { background: #d35400; }

			/* --- å½±ç‰‡å±¤ --- */
			#video-overlay {
			  position: fixed;
			  top: 0;
			  left: 0;
			  width: 100vw;
			  height: 100vh;

			  display: flex;              /* é è¨­ç•«é¢ç½®ä¸­*/
			  justify-content: center;    /* æ°´å¹³ç½®ä¸­ */
			  align-items: center;        /* å‚ç›´ç½®ä¸­ */

			  background: rgba(0, 0, 0, 0.9);
			  z-index: 9999;
			  
			  visibility: hidden;
			  opacity: 0;
			  transition: opacity 0.3s ease;
			}
			
			#video-overlay.show {
			  visibility: visible;
			  opacity: 1;
			}

			#story-video {
			  width: 100%;
			  height: auto;
			  max-width: 90vw;
			  max-height: 90vh;
			  object-fit: contain;
			}
			
			
			/* --- é»‘å¹•è½‰å ´æ¨¡å¼ --- */
			body.mode-black {
				background: black;
				color: white;
			}

			.mode-black #game-container {
				background: transparent;
				box-shadow: none;
			}

			.mode-black #story-section {
				height: 100vh;
				display: flex;
				justify-content: center;   /* å‚ç›´ç½®ä¸­ */
				align-items: center;       /* æ°´å¹³ç½®ä¸­ */
			}

			.mode-black #dialogue-box {
				background: transparent;
				border: none;
				cursor: pointer;
				min-height: auto;
				max-width: 800px;
			}	

			.mode-black #character-name,
			.mode-black #portrait,
			.mode-black #choices-area {
				display: none;
			}

			.mode-black #dialogue-text {
				font-size: 1.6rem;
				line-height: 1.8;
				text-align: center;
				white-space: pre-wrap;
			}

		</style>
		
	</head>
	<body class="mode-adventure">

	<div id="game-container">
		<div id="story-section">
			<div id="portrait">ğŸ‘§</div>
			<div id="dialogue-box">
				<div id="character-name">æ—ç™½</div>
				<div id="dialogue-text">è«‹è¼¸å…¥ç©å®¶ ID</div>
			</div>
		</div>

		<div id="choices-area" class="choices-area"></div>

		<div id="video-overlay" >
		  <video id="story-video" playsinline webkit-playsinline controls >
			<source src="" type="video/mp4">
		</video>
		</div>
	
	</div>
	
	<!-- âœ… éŸ³æ¨‚å…ƒä»¶æ”¾é€™è£¡ -->
	<audio id="bgm" src="audios/bgm.mp3" loop></audio>
  
	<script>
	// ==================== åŸºæœ¬ç‹€æ…‹ ====================
		let playerName = "";
		
		//å®šç¾©èƒŒæ™¯éŸ³æ¨‚
		const BGM_LIST = {
		  cute: "audios/cute.mp3",
		  god: "audios/god.mp3",
		  guess: "audios/guess.mp3",
		  blackbgm: "audios/blackbgm.mp3",
		  god2: "audios/god2.mp3"
		};

		const bgm = document.getElementById("bgm");
		let currentBGMkey = null;
		let userInteracted = false;

		
		// ==================== Google Form å–®é¡Œé€å‡º ====================
		function submitQuestionResult(qNum, playerChoice, correctAnswer) {
		  const isCorrect = playerChoice === correctAnswer ? 1 : 0;

			  fetch("https://docs.google.com/forms/u/0/d/e/1FAIpQLSd-Bixh-2t6YxcDft7waVWTjRQcxe8ELjDjKs_cou9Any7pVQ/formResponse", {
				method: "POST",
				mode: "no-cors",
				headers: { "Content-Type": "application/x-www-form-urlencoded" },
				body: new URLSearchParams({
				  "entry.459675020": playerName,
				  "entry.567840841": qNum,
				  "entry.1209246976": playerChoice,
				  "entry.451095050": correctAnswer,
				  "entry.447682042": isCorrect
				})
			  });
			}

		// ====== 1. éŠæˆ²è³‡æ–™ï¼ˆä¹‹å¾Œåªè¦æ”¹é€™è£¡å°±å¥½ï¼‰ ======
		
		// æœ€ä¸€é–‹å§‹é¡¯ç¤ºè¼¸å…¥ ID ç•«é¢
		function renderIDInput() {
		document.getElementById('character-name').innerText = "æ—ç™½";
		document.getElementById('dialogue-text').innerText = "è«‹è¼¸å…¥ä½ çš„ç©å®¶ ID";
		
		  const area = document.getElementById('choices-area');
		  area.innerHTML = "";
		  
		  const input = document.createElement("input");
		  input.type = "text";
		  input.placeholder = "ç©å®¶ ID";
		  input.style.padding = "10px";
		  input.style.width = "100%";
		  input.style.fontSize = "1rem";

		  const btn = document.createElement("button");
		  btn.className = "choice-btn";
		  btn.innerText = "é–‹å§‹éŠæˆ²";

		  btn.onclick = () => {
			if (!input.value.trim()) {
			  alert("è«‹è¼¸å…¥ç©å®¶ IDï¼");
			  return;
			}
			userInteracted = true;   // â­â­â­ é—œéµï¼Œç›£æ§ç©å®¶åœ¨ç·šä¸Š
			playerName = input.value.trim();
			
			// â­ ä½¿ç”¨è€…é»æ“Š â†’ æ’­æ”¾éŸ³æ¨‚ï¼ˆåˆæ³•ï¼‰
			playBGM("cute", 0.4);
			showScene("start");
			};

		  area.appendChild(input);
		  area.appendChild(btn);
		}
		
		function playBGM(key, volume = 0.4) {
		let videoReturnBGM = currentBGMKey;
		  if (!userInteracted) return;  //ç©å®¶é›¢é–‹æ™‚åœæ­¢

			  stopBGM();
					
		  if (currentBGMkey === key) return; // åŒä¸€é¦–å°±ä¸é‡æ’­

		  currentBGMkey = key;
		  bgm.src = BGM_LIST[key];
		  bgm.volume = volume;
		  bgm.play();
		}

		function stopBGM() {
		  bgm.pause();
		}

		function resumeBGM() {  //ç©å®¶å›ä¾†æ™‚é‡æ’­
		  if (!userInteracted) return;
		  if (bgm.paused && currentBGMKey) {
			bgm.play().catch(() => {});
		  }
		}
		
		function playSound(src) {  //éŸ³æ•ˆå‚™ç”¨æ’æ§½ï¼Œç¾åœ¨æ²’æœ‰åŠŸèƒ½
		  const sfx = new Audio(src);
		  sfx.volume = 0.8;
		  sfx.play();
		}
		// 1. åˆ†æ”¯åŠ‡æƒ…è³‡æ–™
		const scenes = {
			start: {
				name: "å¼•å°",
				text: "æ­¡è¿ä¾†åˆ°æ©æ©å¯¶å¯¶çš„å¥‡å¹»ä¸–ç•Œã€‚\n\næƒ³çŸ¥é“æˆ‘çš„æ€§åˆ¥å—ï¼Ÿ\né‚£å°±å…ˆé™ªæˆ‘èµ°ä¸€æ®µæ•…äº‹å§ã€‚",
				choices: [{ text: "é€²å…¥æ•…äº‹", next: "take1" }]
			},
			take1: {
				name: "å°å¥³å­©",
				text: "åœ¨é€™å€‹å¯’å†·çš„æ—¥å­è£¡ï¼Œä½ æè‘—è£è‘—ç«æŸ´çš„å°æœ¨ç±ƒï¼Œé¢å°å‘¼å˜¯è€Œä¾†çš„é¢¨é›ªã€‚ä½ æ‰¯è‘—å–‰åš¨å–Šé“ï¼š",
				choices: [
					{ text: "æœ‰æ²’æœ‰äººè¦è²·ç«æŸ´ï¼Ÿ", next: "a1_1" },
					{ text: "æœ‰æ²’æœ‰äººè¦è²·å¥³å­©ï¼Ÿ", next: "a1_2" },
					{ text: "ä¸å–Šäº†ï¼Œé»äº®ç±ƒå­è£¡çš„ç«æŸ´", next: "a1_3" }
				]
			},
			a1_1: {
				name: "å°å¥³å­©",
				text: "ä¾†ä¾†å»å»çš„äººå€‘å°ä½ ä¸å±‘ä¸€é¡§ã€‚\nå†·åˆ°ä¸è¡Œçš„ä½ åªå¥½é»ç‡ƒç«æŸ´ã€‚\n\nå“‡ï½æ˜¯å¤§é¤ï¼å“‡ï½æ˜¯ç¦®ç‰©ï¼\nå“‡ï½æ˜¯é˜¿ç½µã„Ÿï¼\n\né˜¿ç½µï¼šè·Ÿæˆ‘åˆ°å¤©åœ‹å»å§ã€‚",
				choices: [{ text: "â€¦â€¦", next: "rip" }]
			},
			a1_2: {
				name: "è­¦å¯Ÿ",
				text: "æ­ä¼Šæ­ä¼Šï¼Œè­¦è»Šä¾†äº†ã€‚\nè­¦å¯Ÿï¼šä½ æ¶‰å«Œè²·è³£å¹¼ç«¥ï¼Œä¾ç…§ç«æŸ´æ³•å°‡ä½ ä¸ŠéŠ¬ã€‚åœ¨ç›£ç„è£¡ï¼Œä½ å†·åˆ°ä¸è¡Œï¼Œé»ç‡ƒç«æŸ´â€¦â€¦\n\né˜¿ç½µï¼šè·Ÿæˆ‘åˆ°å¤©åœ‹å»å§ã€‚",
				choices: [{ text: "â€¦â€¦", next: "rip" }]
			},
			a1_3: {
				name: "å°å¥³å­©",
				text: "ä½ é åœ¨æ¨¹æ—é»ç‡ƒç«æŸ´ã€‚\nå“‡ï¼æ˜¯ä¸€é™£å¤§é¢¨é¢³ä¾†ï¼Œç«æ»…äº†ã€‚\nåˆé»ä¸€æ ¹ï¼Œæ¨¹ä¸Šçš„é›ªè“‹äº†ä½ ä¸€èº«ã€‚\næœ€å¾Œä¸€æ ¹ç«æŸ´...å“‡ï½æ˜¯é˜¿ç½µã„Ÿã€‚\n\né˜¿ç½µï¼šè·Ÿæˆ‘åˆ°å¤©åœ‹å»å§ã€‚",
				choices: [{ text: "â€¦â€¦", next: "rip" }]
			},
			rip: {
				name: "çµ‚å±€",
				text: "ç•«é¢ä¸€é»‘ã€‚\n\nR.I.P.\n\nè«‹å•ä½ è¦å¾©æ´»å†ä¾†ï¼Œé‚„æ˜¯ä¸Šå¤©å ‚å‘¢ï¼Ÿ",
				choices: [
					{ text: "å¾©æ´»å†ä¾†", next: "take1" },
					{ text: "ä¸Šå¤©å ‚", next: "HEAVEN_EVENT" }
				]
			}
		};

		// 2. å¤©åº­ç·šæ€§å°è©±è³‡æ–™
		const roles = {
			"å°å¥³å­©": { color: "#ff9ff3", img: "ğŸ‘§" },
			"é˜¿ç½µ": { color: "#54a0ff", img: "ğŸ‘µ" },
			"åŒ—æ–—æ˜Ÿå›": { color: "#ee5253", img: "ğŸ‘º" },
			"å—æ–—æ˜Ÿå›": { color: "#10ac84", img: "ğŸ‘´" },
			"è¨»ç”Ÿå¨˜å¨˜": { color: "#feca57", img: "ğŸ‘¸" },
			"è²¡ç¥çˆº": { color: "#ff9f43", img: "ğŸ’°" },
			"æˆ‘": { color: "#00d2d3", img: "ğŸ‘¤" },
			"æ—ç™½": { color: "#ffffff", img: "ğŸ“œ" }
		};
		

		const scripts = [
			{ role: "æ—ç™½", text: "å‚³èªªæ¯å€‹äººæŠ•èƒå‰éƒ½æ˜¯èŠ±å¢è£¡çš„èŠ±", black: true},
			{ role: "æ—ç™½", text: "æ¯æœµèŠ±éƒ½ç”±èŠ±å…¬èŠ±å©†ç´°å¿ƒç…§æ–™è‘—", black: true},
			{ role: "æ—ç™½", text: "è€Œç™½èŠ±æ˜¯ç”·å­©ï¼Œç´…èŠ±å‰‡æ˜¯å¥³å­©...", black: true},
			{ 
			role: "æ—ç™½", 
			text: "æ­¡è¿æ‚¨ä¾†åˆ°å¤©å ‚ã€‚",
			black: true
			},
			{ role: "æ—ç™½", text: "ä½ çš„é¢å‰é›²éœ§ç¹šç¹ï¼Œå‡ºç¾äº†å…©ä½ç¥ç§˜è€è€…ï¼Œä¸€ä½æ˜¯å—æ–—æ˜Ÿå›ï¼Œä¸€ä½æ˜¯åŒ—æ–—æ˜Ÿå›" },
			{ role: "æ—ç™½", text: "å‚³èªª...å—æ–—æ˜Ÿå›ï¼ŒæŒç®¡ç”Ÿå‘½ã€å£½å‘½èˆ‡çˆµç¥¿ã€‚ä»–æ˜¯è±¡å¾µã€Œç”Ÿæ©Ÿã€çš„ç¥ï¼Œéˆé­‚è¦é™è‡¨äººé–“æ™‚ï¼Œæ˜¯ç”±å—æ–—æ˜Ÿå›è³¦äºˆç”Ÿå‘½åŠ›ã€‚\nè€ŒåŒ—æ–—æ˜Ÿå›ï¼ŒæŒç®¡æ­»äº¡èˆ‡å¯©åˆ¤ï¼Œæ±ºå®šä¸€å€‹äººçš„ç”Ÿå‘½ä½•æ™‚çµæŸã€‚" },
			{ role: "åŒ—æ–—æ˜Ÿå›", text: "å”‰å‘¦å¨å£“ï¼ä½ ä¸åœ¨æˆ‘çš„åå–®è£¡ï¼Œä½ æ€éº¼åœ¨é€™ï¼Ÿï¼" },
			{ role: "æˆ‘", text: "æˆ‘....æˆ‘æ˜¯è¢«é˜¿ç½µå¸¶ä¾†çš„..." },
			{ role: "åŒ—æ–—æ˜Ÿå›", text: "ï¼ˆæ‰¶é¡ï¼‰ç‰›é ­é¦¬é¢ï¼Œä½ å€‘ç‰›é¦¬çµ„ä¸æ˜¯ç¼ºäººå—ï¼Ÿé€™å‚¢ä¼™çœ‹èµ·ä¾†æŒºç¤¾ç•œçš„ã€‚" },
			{ role: "ACTION", action: "video" , type: "video",src: "videos/9527.mp4" },   // â­ æ’åœ¨é€™(9527å½±ç‰‡)
			{ role: "æˆ‘", text: "ç­‰ä¸€ç­‰!!!"},
			//{ role: "æˆ‘", text: "ç¨Ÿå¤§äººï¼Œå°äººæœ¬ä½åœ¨è˜‡å·çš„åŸé‚Šï¼Œ å®¶ä¸­æœ‰å±‹åˆæœ‰ç”°ï¼Œç”Ÿæ´»æ¨‚ç„¡é‚Šã€‚"},
			//{ role: "æˆ‘", text: "èª°çŸ¥é‚£å”ä¼¯è™ï¼Œä»–è »æ©«ä¸ç•™æƒ…ï¼Œå‹¾çµå®˜ä¿¯ç›®ç„¡å¤©ï¼Œå æˆ‘å¤§å±‹å¥ªæˆ‘ç”°ï¼Œæˆ‘çˆºçˆºè·Ÿä»–ä¾†ç¿»è‡‰ï¼Œæ…˜è¢«ä»–ä¸€æ£ä¾†æ‰“æ‰ï¼Œ...  "},
			//{ role: "æˆ‘", text: "æœ€çµ‚æµè½åˆ°æ±Ÿé‚Šã€‚ç‚ºæ±‚é¤Šè€çˆ¹ï¼Œåªæœ‰ç¨è³£ç«æŸ´åœ¨å»Ÿå‰ã€‚... èª°çŸ¥é‚£å”ä¼¯è™ï¼Œä»–å¯¦åœ¨å¤ªé™°éšª çŸ¥é“æ­¤æƒ…å½¢ï¼Œç«Ÿæ´¾äººä¾†æš—ç®—"},
			//{ role: "æˆ‘", text: "æŠŠæˆ‘çˆ¶å­ç‹‚æ¯†åœ¨å¸‚å‰ï¼Œå°äººèº«å£¯å¥ï¼Œæ®˜å‘½å¾—ç•™å­˜ã€‚ç‚ºæ±‚è‘¬è€çˆ¹ï¼Œå”¯æœ‰è³£èº«ç‚ºå¥´è‡ªä½œè³¤ï¼Œ ä¸€é¢å‹¤è³ºéŒ¢ï¼Œä¸€é¢è®€æ›¸ç¯‡ï¼Œ ç™¼èª“æŠŠåŠŸåé¡¯ï¼Œæ‰‹åˆƒä»‡äººæ„å¿—å …! å¾æ­¤å”å¯…è©©é›†ä¼´èº«é‚Šï¼Œæˆ‘éŠ˜è¨˜æ­¤ä»‡ä¸å…±æˆ´å¤©!!!" },
			{ role: "ACTION", action: "video", type: "video",src: "videos/madam4.mp4"  }, 
			//{ role: "æˆ‘", text: "...å°äººç‚ºæ±‚è‘¬è€çˆ¹ï¼Œå”¯æœ‰è³£èº«ç‚ºå¥´è‡ªä½œè³¤ï¼å¾æ­¤å”å¯…è©©é›†ä¼´èº«é‚Šï¼Œæˆ‘éŠ˜è¨˜æ­¤ä»‡ä¸å…±æˆ´å¤©ï¼ï¼ï¼" },
			{ role: "åŒ—æ–—æ˜Ÿå›", text: "ç„¶å¾Œï¼Ÿ" },
			{ role: "æˆ‘", text: "ç„¶å¾Œ....å°±è¢«é˜¿ç½µå¸¶ä¸Šä¾†äº†ã€‚" },
			{ role: "åŒ—æ–—æ˜Ÿå›", text: "ï¼ˆé€™äººæ€ªæ€ªçš„...ï¼‰" },
			{ role: "å—æ–—æ˜Ÿå›", text: "é€™ä¸ä¹ŸæŒºæœ‰è¶£çš„å—ï¼Ÿå’¦?è¨»ç”Ÿå¨˜å¨˜è·Ÿè²¡ç¥çˆºå‰›å¥½ä¹Ÿä¾†å•¦!ä¸å¦‚å°±çµ¦ä»–å€‹é‡ç”Ÿçš„å¥½æ©Ÿæœƒå§ã€‚" },
			{ role: "è¨»ç”Ÿå¨˜å¨˜", text: "é‚£éº¼...æˆ‘å®‰æ’å€‹æ™®é€šä½†æœ‰æ„›çš„å®¶,è²¡ç¥çˆºè² è²¬çµ¦ä»–éŒ¢éŒ¢èŠ±ï¼Œè‡³æ–¼æ€§åˆ¥å˜›ï¼Œå°±æ±ºå®šç‚º..." },
			{ role: "è²¡ç¥çˆº", text: "ä¸”æ…¢!æ—¢ç„¶æˆ‘éƒ½åƒä¸€è…³äº†ï¼Œä¸å¦‚é€™å°å‚¢ä¼™çŒœçŒœçœ‹ï¼Œè¨»ç”Ÿå¨˜å¨˜ç‚ºä»–å®‰æ’çš„æ˜¯ç”·å­©é‚„æ˜¯å¥³å­©" },
			{ role: "æ—ç™½", text: "è²¡ç¥çˆºæº–å‚™äº†7é“è…¦å½æ€¥è½‰ç­‹ï¼Œæ˜¯ç”·é‚„æ˜¯å¥³å­©å…¨è—åœ¨è¬åº•è£¡é¢ \n\näº‹ä¸å®œé²ï¼Œè§£é¡Œé–‹å§‹!!" },
			{ role: "ACTION", action: "quiz" }
		];

		// 3. æ¸¬é©—é¡Œç›®
		const questions = [
			{ q: "å“†å•¦Aå¤¢æ˜¯ä»€éº¼é¡è‰²ï¼Ÿ", a: ["ç´…è‰²", "è—è‰²"], correct: 0 },
			{ q: "èª°æœ€æ„›äº‚è²·æ±è¥¿ï¼Ÿ", a: ["ç…å­", "è€è™", "æ–‘é¦¬"], correct: 2 },
			{ q: "å¾ˆå¯æ„›çš„èèŸ»å«ä»€éº¼ï¼Ÿ", a: ["å¯æ„›èŸ»", "å²ç‹—èŸ»", "å¡å“‡èŸ»"], correct: 2 },
			{ q: "èª°æ²’ç”Ÿå­©å­å°±å…ˆç•¶ä¸Šäº†å¨˜ï¼Ÿ", a: ["å½å¨˜", "æ–°å¨˜", "å–µå¨˜"], correct: 1 },
			{ q: "å¼µé›¨ç”Ÿå®¶è£¡çš„æœ¨é ­éƒ½å“ªè£¡ä¾†çš„ï¼Ÿ", a: ["è²·ä¾†çš„", "é‹¸ä¾†çš„", "ç¨®ä¾†çš„"], correct: 1 },
			{ q: "é€™æ˜¯è…³çš„è‹±æ–‡æ€éº¼èªªï¼Ÿ", a: ["foot", "Oliver", "Jessica"], correct: 2 },
			{ q: "å±è‚¡çš„è‹±æ–‡æ€éº¼èªªï¼Ÿ", a: ["bottom", "KK ass", "Jessica Chen"], correct: 2 }
		];

		// 4. éŠæˆ²æ§åˆ¶è®Šæ•¸
		let currentStep = 0;
		let currentQuiz = 0;
		let score = 0;
		let isHeavenMode = false;

		window.onload = () => { renderIDInput(); };

		// åŸ·è¡Œåˆ†æ”¯åŠ‡æƒ…
		function showScene(key, skipClear = false) {
			if (key === "HEAVEN_EVENT") { enterHeaven(); return; }

			const scene = scenes[key];
			document.getElementById('character-name').innerText = scene.name;
			document.getElementById('dialogue-text').innerText = scene.text;

			const choicesArea = document.getElementById('choices-area');
			if (!skipClear) choicesArea.innerHTML = ''; // åªåœ¨éŠæˆ²æ­£å¼å ´æ™¯æ‰æ¸…ç©º

			if(scene.choices){
				scene.choices.forEach(c => {
					const btn = document.createElement('button');
					btn.className = 'choice-btn';
					btn.innerText = c.text;
					btn.onclick = () => showScene(c.next);
					choicesArea.appendChild(btn);
				});
			}
		}


		// åˆ‡æ›åˆ°å¤©åº­æ¨¡å¼
		function enterHeaven() {
			isHeavenMode = true;
			document.body.className = "mode-heaven";
			document.getElementById('choices-area').innerHTML = '';
			document.getElementById('dialogue-box').onclick = nextStep;
			nextStep();
		}

		// ç·šæ€§å°è©±æ§åˆ¶
		function nextStep() {
		if (!isHeavenMode || currentStep >= scripts.length) return;

		const data = scripts[currentStep];

		// ACTION ç‰¹æ®Šè™•ç†
		if (data.role === "ACTION") {
			
			if (data.action === "video") {
				playVideo(data.src); //å‘¼å«playvideo function
				return;
			}	

			
			if (data.action === "quiz") {
			currentStep++;
			startQuiz();   // â­ å•Ÿå‹•å•ç­”
			playBGM("guess",0.4);
			return;
			}
		}

		// â­ é»‘å¹•è½‰å ´åˆ¤æ–·
		if (data.black) {
			document.body.className = "mode-black";
			playBGM("blackbgm",0.4);
		} 
		else {
			document.body.className = "mode-heaven";
			playBGM("god2",0.4);
		}

		// é¡¯ç¤ºå…§å®¹
		document.getElementById('character-name').innerText = data.role;
		document.getElementById('character-name').style.color = roles[data.role]?.color || "#fff";
		document.getElementById('dialogue-text').innerText = data.text;
		document.getElementById('portrait').innerText = roles[data.role]?.img || "";

		currentStep++;
		}


		function closeVideo() {
			document.getElementById('video-overlay').style.display = 'none';
			currentStep++;
			nextStep();
		}

		
		function playVideo(src) {  //å½±ç‰‡æ’­æ”¾é‚è¼¯
		  const videoOverlay = document.getElementById("video-overlay");
		  const video = document.getElementById("story-video");
		  if (!bgm.paused) {  // æš«åœéŸ³æ¨‚è€Œä¸æ˜¯ stop
			bgm.pause();
		}

		  // éš±è—æ–‡å­—å€
		  document.getElementById("story-section").style.display = "none";

		  // é¡¯ç¤ºå½±ç‰‡
		  video.src = src;
		  video.currentTime = 0;
		  
		  videoOverlay.classList.add("show");
		  video.play();
		  
		  //è·³éå½±ç‰‡
		  videoOverlay.onclick = endVideo;
		  video.onended = endVideo;
		  }
		
		function endVideo() {
		  const videoOverlay = document.getElementById("video-overlay");
		  const video = document.getElementById("story-video");

		  // âœ… åœå½±ç‰‡ï¼ˆæœ€é‡è¦ï¼‰
		  video.pause();
		  video.currentTime = 0;
		  video.removeAttribute("src");
		  video.load();

		  // é—œç•«é¢
		  videoOverlay.classList.remove("show");
		  videoOverlay.onclick = null;

		  // å›åˆ°æ–‡å­—
		  document.getElementById("story-section").style.display = "flex";

		  // å›åˆ°åŠ‡æƒ…
		  currentStep++;
		  nextStep();

		  // éŸ³æ¨‚æ¥å›ä¾†
		  if (vudeiReturnBGM) {
		  playBGM(videoReturnBGM, 0.4);
		}

		

		// æ¸¬é©—é‚è¼¯
		function startQuiz() {
			document.getElementById('dialogue-box').onclick = null; // æ¸¬é©—æ™‚æš«åœé»æ“Šå°è©±
			showQuestion();
		}

		function showQuestion() {
			if (currentQuiz >= questions.length) {
				showFinalResult();
				return;
			}
			const q = questions[currentQuiz];
			document.getElementById('character-name').innerText = "è²¡ç¥çˆºçš„è€ƒé©—";
			document.getElementById('dialogue-text').innerText = `ç¬¬ ${currentQuiz + 1} é¡Œï¼š${q.q}`;
			
			const area = document.getElementById('choices-area');
			area.innerHTML = '';
			q.a.forEach((opt, idx) => {
				const btn = document.createElement('button');
				btn.className = 'choice-btn';
				btn.innerText = opt;
				btn.onclick = () => {
					if (idx === q.correct) score++;
					//åŸ·è¡Œé€å‡ºç­”æ¡ˆç´€éŒ„
					submitQuestionResult(
					  currentQuiz + 1,
					  opt,
					  q.a[q.correct]
					);
					currentQuiz++;
					showQuestion();
				};
				

				area.appendChild(btn);
			});
		}


		function showFinalResult() {
			const area = document.getElementById('choices-area');
			area.innerHTML = ''; 
			
			document.getElementById('portrait').innerText = "ğŸ’°";
			document.getElementById('character-name').innerText = "è²¡ç¥çˆº";
			
			// é€™è£¡å…ˆä¸çµ¦åŠ æŒï¼Œåªé¡¯ç¤ºç­”å°é¡Œæ•¸ï¼Œå¼•å°ç©å®¶åšæœ€å¾Œé¸æ“‡
			document.getElementById('dialogue-text').innerText = `è€ƒé©—çµæŸï¼ä½ ä¸€å…±ç­”å°äº† ${score} é¡Œã€‚\n\nç¾åœ¨ï¼Œåˆ°äº†æœ€é‡è¦çš„æ™‚åˆ»... \nè«‹æŠ•ä¸‹ä½ ç¥è–çš„ä¸€ç¥¨ï¼Œä½ è¦ºå¾—æ©æ©å¯¶å¯¶æ˜¯ï¼Ÿ`;
			
			// å»ºç«‹ç”·å¯¶æŒ‰éˆ•
			const boyBtn = document.createElement('button');
			boyBtn.className = 'choice-btn';
			boyBtn.innerText = "â™‚ å¸¥æ°£ç”·å¯¶";
			boyBtn.style.background = "#54a0ff";
			boyBtn.style.color = "white";
			boyBtn.onclick = () => saveAndFinish("ç”·å¯¶");
			
			// å»ºç«‹å¥³å¯¶æŒ‰éˆ•
			const girlBtn = document.createElement('button');
			girlBtn.className = 'choice-btn';
			girlBtn.innerText = "â™€ å¯æ„›å¥³å¯¶";
			girlBtn.style.background = "#ff9ff3";
			girlBtn.style.color = "white";
			girlBtn.onclick = () => saveAndFinish("å¥³å¯¶");
			
			area.appendChild(boyBtn);
			area.appendChild(girlBtn);
		}

		function saveAndFinish(genderPick) {
			// â­â­â­ é€å‡ºã€Œæœ€çµ‚æ€§åˆ¥é¸æ“‡ã€åˆ° Google Form â­â­â­
			submitQuestionResult(
				"æœ€çµ‚æ€§åˆ¥æŠ•ç¥¨", // é¡Œç›®æ¬„
				genderPick,      // ç©å®¶é¸æ“‡ï¼šç”·å¯¶ / å¥³å¯¶
				"å¥³å¯¶"           // æ­£ç¢ºç­”æ¡ˆï¼ˆä½ å·²è¨­å®šæ©æ©æ˜¯å¥³å¯¶ï¼‰
			);
			const area = document.getElementById('choices-area');
			area.innerHTML = ''; // é»å®Œå¾Œæ¸…ç©ºæŒ‰éˆ•ï¼Œé¿å…é‡è¤‡é»æ“Š
			
			let finalMessage = "";
			let finalTitle = "";
			
			if (genderPick === "å¥³å¯¶") {
				// çŒœå°äº† (æ­£ç¢ºç­”æ¡ˆï¼šå¥³å¯¶)
				finalTitle = "è²¡ç¥çˆºï¼šå¤§å–œï¼";
				document.getElementById('portrait').innerText = "ğŸ‘¸"; // æ›æˆè¨»ç”Ÿå¨˜å¨˜æˆ–é–‹å¿ƒçš„è¡¨æƒ…
				finalMessage = `æ­å–œä½ çŒœå°äº†ï¼æ©æ©å¯¶å¯¶æ˜¯å€‹ã€å¯æ„›å¥³å¯¶å¯¶ã€‘ï¼\n\nè²¡ç¥çˆºçµ¦ä½ åŠ æŒï¼š\nã€ç¥ä½ æ—¥é€²æ–—é‡‘ï¼ŒåŠ å®˜æ™‰çˆµï¼ã€‘\nä»¥åŠçœ¾ç¥çµ¦ä½ ç¥ç¦ï¼š\nã€åœ¨æœªä¾†çš„æ—¥å­è£¡ä¸€å¸†é¢¨é †ã€èº«é«”å¥åº·ã€å¹³å®‰å–œæ¨‚ã€‚ã€‘`;
			} else {
				// çŒœéŒ¯äº† (é¸äº†ç”·å¯¶)
				finalTitle = "çœ¾ç¥æ˜çš„ç¥ç¦";
				document.getElementById('portrait').innerText = "âœ¨"; 
				finalMessage = `é›–ç„¶çŒœéŒ¯äº†ï¼ˆå…¶å¯¦æ©æ©å¯¶å¯¶æ˜¯å€‹å¥³å­©å­å”·ï¼ï¼‰ï¼Œä½†ç¥æ˜å€‘æ„Ÿå—åˆ°ä½ çš„åƒèˆ‡ã€‚\n\nç‰¹æ­¤ç¥ç¦ä½ ï¼š\nã€åœ¨æœªä¾†çš„æ—¥å­è£¡ä¸€å¸†é¢¨é †ã€èº«é«”å¥åº·ã€å¹³å®‰å–œæ¨‚ã€‚ã€‘`;
			}
			
			document.getElementById('character-name').innerText = finalTitle;
			document.getElementById('dialogue-text').innerText = finalMessage;
			
			// â­ 5 ç§’å¾Œè‡ªå‹•çµæŸ
			  const endTimer = setTimeout(endGame, 10000);

			  // â­ é»æ“Šä»»æ„è™•ç«‹åˆ»çµæŸ
			  document.getElementById("dialogue-box").onclick = () => {
				clearTimeout(endTimer); // æ¸…æ‰è¨ˆæ™‚å™¨
				endGame();
			};
		}
		function endGame() {
		  // 1ï¸âƒ£ åœæ­¢æµç¨‹
		  isHeavenMode = false;

		  // 2ï¸âƒ£ åœæ­¢éŸ³æ¨‚
		  stopBGM();

		  // 3ï¸âƒ£ æ¸…ç©ºé¸é …
		  document.getElementById("choices-area").innerHTML = "";

		  // 4ï¸âƒ£ é¡¯ç¤ºçµæŸæ–‡å­—
		  document.getElementById("character-name").innerText = "æ—ç™½";
		  document.getElementById("dialogue-text").innerText =
			`ğŸ‰ éŠæˆ²çµæŸ ğŸ‰\n\n` +
			`ç©å®¶ï¼š${playerName}\n` +
			`æ„Ÿè¬åƒèˆ‡é€™å ´ç”Ÿå‘½æ—…ç¨‹ï¼`;

		  // 5ï¸âƒ£ï¼ˆå¯é¸ï¼‰é–ä½é»æ“Š
		  document.getElementById("dialogue-box").onclick = null;
		}
		
		document.addEventListener("visibilitychange", () => {
		  if (document.hidden) {
			stopBGM();
		  } else {
			resumeBGM();
		  }
		});

		window.addEventListener("pagehide", stopBGM);
	
	</script>

	</body>
	</html>
